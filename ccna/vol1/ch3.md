# Fundamentals of WANs and IP routing

- There are two types of WAN links: serial links and Ethernet WAN links. In their most basic form, these WAN links connect routers that sit at sites that can be miles to hundreds of miles apart, allowing communication between remote sites.
- WAN technologies define the physical (Layer 1) standards and data-link (Layer 2) protocols used to communicate long distances.
- To connect LANs using a WAN, the internetwork uses a router connected to each LAN, with a WAN link between the routers First, the enterprise's network engineer would order some kind of WAN link. A router at each site connects to both the WAN and the LAN. [Summary](https://postimg.cc/WFP3cJg7).
- The leased line service delivers bits in both directions, at a predetermined speed, using full-duplex logic. In fact, conceptually it acts as if you had a full-duplex crossover Ethernet link between two routers. The leased line uses two pairs of wires, one pair for each direction of sending data, which allows full-duplex operation. [Summary](https://postimg.cc/bGKs3Bmd)
- To create such possibly long links or circuits, a leased line does not actually exist as a single long cable between the two sites. Instead, the telephone company (telco) that creates the leased line installs a large network of cables and specialized switching devices to create its own computer network. The telco network creates a service that acts like crossover cable between two points, but the physical reality is hidden from the customer. [Summary](https://postimg.cc/B8Yx43J6)
- Because leased lines define only layer 1 transmission service, many companies and standard orgranizations have created data-link protocols to control and use leased lines. Today, the most popular data-link layer protocols used for leased lines between two routers are **High-Level Data Link** (HDLC) and **Point-to-Point Protocol** (PPP).
- All data-link protocols perform a similar role: to control the correct delivery of data over a physical link of a particular type. HDLC has less work to do than Ethernet because of the simple point-to-point topology of a leased line. When one router sends an HDLC frame, the frame can go only to one place: to the other end of the link. So, while HDLC has an address field, the destination is implied. [HDLC Header](https://postimg.cc/6TKfnn0V)
- ISO standard HDLC does not have a Type field, and routers need to know about the type of the packet inside the frame. So, Cisco routers use a Cisco-proprietary variation of HDLC hat adds a Type field. 
- [HDLC summary](https://postimg.cc/qgQMQH8b)
- Today, many WAN service providers (SP) offer WAN services that take advantage of Ethernet. SPs offer a wide variety of these Ethernet WAN services, with many different names. The customer connects to an Ethernet link using a router interface. The (fiber) Ethernet link leaves the customer building and connects to some nearby SP location called point of presence (PoP). Instead of a telco switch, the SP uses an Ethernet switch.
- **Ethernet over MPLS (EoMPLS)**: A term that refers to Multiprotocol Label Switching, a technology that can be used  to create the Ethernet service for the customer.
- WANs, by their very nature, give IP routers a way to forward IP packets from a LAN at one site, over the WAN, and to another LAN at another site. Routing over EoMPLS WAN link still uses the WAN like a WAN, as a way to forward IP packets from one site to another, However, the WAN link happens to use the same Ethernet protocols as the Ethernet links at each site.
- [Ethernet WAN Summary](https://postimg.cc/0rKtxDf7)
- At the network layer of TCP/IP, two options exist for the main protocol around which all other network layer functions revolve: **IP version 4** (IPv4) and **IP version 6** (IPv6).
- Internet Protocol (IP) focuses on the job of routing data, in the form of IP packets, from the source host to the destination host. IP does not concern itself with the physical transmission of data, instead relying on the lower TCP/IP layers to do the physical transmission of the data. Instead, IP concerns itself with the logical details, rather than physical details, of delivering data. In particular, the network layer specifies how the packets travel end to end over a TCP/IP network, even when the packet crosses many different types of LAN and WAN links.
- Routers and end-user computers work together to perform IP routing. The host operating system has TCP/IP software, including the software that implements the network layer. Hosts use that software to choose where to send IP packets, often to a nearby router. Those routers make choices of where to send the IP packet next. Together, the hosts and routers deliver the IP packet to the correct destination.
- The default router is also called as the _default gateway_.
- All routers use the same general process to route the packet. Each router keeps an _IP routing table_. This table lists IP address _groupings_, called _IP networks_ and _IP subnets_. When the router receives a packet, it compares the packet's destination IP address to the entries in the routing table and makes a match. This matching entry also lists directions that tell the router where to forward the packet next.
- [How network layer uses LANs and WANs](https://postimg.cc/0z74tqzM)  
- An example of how the router determines which data link addres to use is the IP **Address Resolution Protocol** (ARP). ARP _dynamically learns the data-link address of an IP host connected to the LAN_.
- TCP groups IP address together so that IP addresses used on the same physical network are part of the same group. IP calls these address groups an _IP network_ and _IP subnet_. From the perspective of IP routing, the grouping of IP addresses means that the routing table can be much smaller. A router can list one routing entry for each IP network or subnet, instead of one entry for every single IP address.
- Key points of subnetting:
    - Two IP addresses, not separated from each other by a router, must be in the same group (subnet).
    - Two IP addresses, separated from each other by at least one router, must be in different group (subnets).
- The routing protcol also makes use of IPv4 header. The header lists a 32-bit source IP address, as well as 32-bit destination IP address. Note that, while routers remove and add data-link headers each time it routers a packet, the IP header remains, with the IP addresses unchanged by the IP routing process. [IPv4 Header](https://postimg.cc/9rVGjNdS)
- The best method for routers to know all the useful routes is to configure the routers to use the same IP routing protocol. If you enable the same routing protocol on all the routers in the TCP/IP network, with the correct settingsm the routers will send routing protocols messages to each other. As a result, all the routers will learn routes for all the IP networks and subnets in the TCP/IP internetwork.
- TCP/IP needs a way to let a computer find the IP address used by the listed hostname, and that method uses the **Domain Name System** (DNS). DNS defines protocols, as well as standards for the text names used throughout the world, and a worldwide set of distributed DNS servers. Also, no single DNS server knows all the names and matching IP addresses, but the information is distributed across many DNS servers. [Summary](https://postimg.cc/8FLg85BL)
-  TCP/IP defines the Address Resolution Protocol (ARP) as the method by which any host or router on a LAN casn dynamically learn the MAC address of another IP host or router on the same LAN. ARP defines a protocol that includes the ARP _Request_, which is a message that makes the simple request "if this is your IP address, please reply with your MAC address". ARP also defines the ARP _Reply_ message which indeed lists both the original IP address and the matching MAC address.
- Note that hosts and routers remember the ARP results, keeping the information in their ARP _cache_ or ARP _table_. You can see the contents of ARP cache on most PC operating systems by using the `arp -a` command from a command prompt. [Summary](https://postimg.cc/SXG2Symz)
- The primary tool for testing basic network connectivity is the **ping** command. Ping uses the **Internet Control Message Protocol**, sending a message called an _ICMP echo request_ to another IP address. The computer with that IP address should reply with _ICMP reply_.
