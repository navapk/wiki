# Analyzing Ethernet LAN Switching

- LANs exist as a set of user devices, servers, and other devices that connect to switches, with the switches connected to each other. The LAN switch has one primary job: to forward frames to the correct destination (MAC) address. And to achieve that goal, switches use logic - logic based on the source and destination MAC address in each frame's Ethernet header.
- LAN switches receive Ethernet frames and then make a switching decision: either forward the frame out some other ports or ignore the frame. To accomplish this primary mission, switches perform three actions:
    - Deciding whether to forward frame or when to filter (not forward) a frame, based on destination MAC address.
    - Perparing to forward frames by learning MAC addreses by examining the source MAC address of each frame received by the switch.
    - Preparing to forward only one copy of the frame to the destination by creating a loop-free environment with other switches by using Spanning Tree Protocol (STP).
- All Ethernet frames have both a destination and source MAC address. Both are 6-bytes long and are a key part of the switching logic.
- To decide whether to forward a frame, a switch uses a dynamically built table that lists MAC addresses and outgoing interfaces. Switches compare the frame's destination MAC address to this table to decide whether the switch should forward the frame or simply ignore it.
- A switch's MAC address table is also called the _switching table_., or _bridging table_ or even the _Content-Addressable Memory (CAM) table_, in reference to the type of physical memory used to store the table.
- [Summary](https://postimg.cc/grLfg72M) 
- A switch's MAC address table lists the location of each MAC relative to that one switch. In LANs with multiple switches, each switch makes an independent forwarding decision based on its own MAC address table. Together, they forward the frame so that it eventually arrives the destination.
- Switches build the address table by listening to incoming frames and examining the _source MAC address_ in the frame. If a frame enters the switch and the source MAC address is not in the address table, the switch creates an entry in the table. That table entry lists the interface from which the frame arrived. Switch learning logic is that simple.
- As it turns out, when ther eis no matching entry in the table, switches forward the frame out all interfaces (except the incoming interface) using a process called _flooding_. And the frame whose destination address is unknown to the switch is called an _unknown unicast frame_ or simply _unknown unicast_.
- Switches flood unknown unicast frames. Flooding means that the switch forwards copies of the frame out all ports, except the port which the frame was received. Th e idea is simple: if you do not know where to send it, send it everywhere, to deliver the frame. And, by the way, the device will likely send a reply - and then the switch can learn that device's MAC address and forward future frames out one port as a known unicast frame.
- Switches also flood LAN broadcast frames (frames destined to the Ethernet braodcast address of FFFF.FFFF.FFFF) because this process helps deliver a copy of the frame to all devices in the LAN.
- The third primary feature of LAN switches is loop prevention, as implemented by Spanning Tree Protocol (STP). Without STP, any flooded frames would loop for an indefinite period of time in Ethernet networks with physically redundant links. To prevent looping frames, STP blocks some ports from forwarding frames so that only one active path exists between any pair of LAN segments.
- And, while the flooding process is a good mechanism for forwarding unknown unicasts and broadcasts, the continual flooding of traffic frames can completely congest the LAN to the point of making it unusable.
- To avoid Layer 2 loops, all switches need to use STP. STP causes each interface on a switch to settle into either a blocking state or a forwarding state. _Blocking_ means that the interface cannot forward or receive frames, while _forwarding_ means that the interface can send and receive data frames. If a correct subset of interfaces is blocked, only a single currently active logical path exists between each pair of LANs.
- Switches do learn MAC addresses, but those MAC addresses do not remain in the table indefinitely. The switch will remove the entries due to age, due to the table filling, and you can remove entries using a command. First, for aging out MAC table entries, switches remove entries that have not been used for a defined number of seconds (default of 300 seconds on many switches). To do that, switches look at every incoming frame and evey source MAC address, and do something related to learning.
- If it is a new MAC address, the switch adds the correct entry to the table, of course. However, if that entry already exists, the switch still does something: it resets the inactivity timer back to 0 for that entry. The switch times out (removes) any entries whose timer reaches that defined aging time.
- [Command Reference](https://postimg.cc/fk0hJxBp)
